#!/usr/bin/env bash

# The 'trash' command moves an item to the Mac OS X trash from within bash
#function trash () {
  #local path
  #for path in "$@"; do
    ## ignore any arguments
    #if [[ "$path" = -* ]]; then :
    #else
      #local dst=${path##*/}
      ## append the time if necessary
      #while [ -e ~/.Trash/"$dst" ]; do
        #dst="$dst "$(date +%H-%M-%S)
      #done
      #mv "$path" ~/.Trash/"$dst"
    #fi
  #done
#}


function fname() { find . -iname "*$@*"; }

# Open a man page as a PDF in Preview.app
pman () {
    man -t $@ | open -f -a /Applications/Preview.app
}

hman () {
  # Create a tmp file with prefix 'hman', then rename it to have a .html extension
  local TMPHTML=`mktemp -t hman`
  mv $TMPHTML "$TMPHTML".html
  TMPHTML="$TMPHTML".html
  
  RAWHTML="$(groff -mandoc -Txhtml -P'-D$TMPDIR' $(man -w $@))"
  if [ $? -ne 0 ]; then
      echo "Error generating HTML from man page" >&2
      return
  fi
  echo "$RAWHTML" | tidy -ashtml 2>/dev/null | \
  sed -e 's/<\/style>/body {font-family: "Helvetica Neue", Helvetica, sans-serif; width: 800px; margin-left: auto; margin-right: auto;}\
       .toc {position: fixed; overflow-y: scroll; overflow-x: hidden; top: 10px; height: 90%; width: 200px; text-transform: lowercase; margin-left: -200px; margin-top: 1.5em; font-size: 11pt; border-right: 1px solid black; }\
       .toc a { line-height: 2em; }\
       .toc p { margin-top: 0em; }\
       .content { font-size: 10pt; margin-left: 50px; }\
       h1 { font-weight: 300; font-size: 64px; margin-top: 0em; letter-spacing: -2px; }\
       h2 { margin-top: 2.5em; font-weight: 300;} \
       p { line-height: 1.25em; margin-top: 1.2em; }\
       h2 + p { margin-top: 0em !important; }<\/style>/' \
-e 's/<p><a href="#heading1">/<div class="toc">\
<p><a href="#heading1">/' \
-e 's/<hr>/<\/div>/' \
-e 's/<h2 id="heading1">/<div class="content">\
<h2 id="heading1">/' > "$TMPHTML"

open "$TMPHTML"
}


# Make a tmp directory, switch to it and copy its name to the system's paste buffer
delme () {
    local TMPDIR="$(mktemp -d -t delme)"
    cd "$TMPDIR"
    pwd | tr -d "\n" | pbcopy
}
