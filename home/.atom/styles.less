@import (reference) "syntax-variables";
// Default value if not defined
@ui-fg: @syntax-text-color;
@ui-theme-name: unknown;
@import (reference) "ui-variables";

// Hack to allow us to bypass the `:extend` command (LESS won't extend selector variables)
@plain-text-editor: atom-text-editor;
// Convenience to save us from having to add a `atom-text-editor::shadow` selector for editors
atom-text-editor::shadow:extend(atom-text-editor all) {}


////////////////////////////////////////////////////////////////////////////////////////////////////
//
//    ######## ##     ## ######## ##     ## ########  ######
//       ##    ##     ## ##       ###   ### ##       ##    ##
//       ##    ##     ## ##       #### #### ##       ##
//       ##    ######### ######   ## ### ## ######    ######
//       ##    ##     ## ##       ##     ## ##             ##
//       ##    ##     ## ##       ##     ## ##       ##    ##
//       ##    ##     ## ######## ##     ## ########  ######
//
////////////////////////////////////////////////////////////////////////////////////////////////////

.chalk-dark-tweaks() when (@syntax-background-color = #151515) {
  // Lighten up the text color of comments
  atom-text-editor {
    .comment,
    .punctuation.definition.comment {
      color: rgba(150, 150, 150, 70%);
    }
  }
}
.chalk-dark-tweaks();


.polaris-syntax-theme-tweaks() when (@syntax-wrap-guide-color = #282a2e) and (@syntax-background-color = #262c31) {
  atom-text-editor, :host {
    .wrap-guide {
      background-color: darken(@syntax-background-color, 4%); //@syntax-indent-guide-color;
    }

    // // For all classes Polaris makes bold, turn off subpixel antialiasing (bold + subpixel AA looks
    // // too heavy/blurry, even on non-Retina screens.)
    // .punctuation.definition.bold,
    // .entity.name.function,
    // .entity.name.class,
    // .entity.name.type.class,
    // .markup.bold {
    //   -webkit-font-smoothing: antialiased !important;
    // }
  }

  atom-text-editor.is-focused, atom-text-editor.is-focused::shadow, :host.is-focused {
    .line.cursor-line {
      background-color: @syntax-gutter-background-color-selected;

      .indent-guide {
        color: @syntax-background-color;
      }
    }
  }
}
.polaris-syntax-theme-tweaks();


// .gruvbox-tweaks() when (@syntax-text-color = rgba(235, 219, 178, 0.5)) {
.gruvbox-tweaks() {
  // Gruvbox uses yellow for editor text, which is unreadable in UI text boxes w/ a light UI theme
  atom-text-editor::shadow *, atom-text-editor .text {
    color: @ui-fg !important; // Use the UI theme's foreground color, not syntax theme's
    text-decoration: line-through;
  }

  div.settings-view atom-text-editor::shadow[mini] {
    .text .source, .string.unquoted.heredoc, .source .source {
      color: @ui-fg !important;
    }
  }
}
// .gruvbox-tweaks();


.robin-hood-tweaks() when (@syntax-wrap-guide-color = #fabd2f) {
  atom-text-editor atom-text-editor-minimap {
    border-left: 3px solid fadeout(@syntax-wrap-guide-color, 60%) !important;
  }
}
// .robin-hood-tweaks();


.isotope-tweaks() {
  html, body { font-size: 14px; }
  .tree-view { font-size: 12px; }
}
// .isotope-tweaks();


.genisis-tweaks() {
  @tab-height: 40px;

  .tab-bar .tab {
    font-size: 12px;
  }

  @import "../../../../../.atom/packages/genesis-ui/styles/tabs";
}
// .genisis-tweaks();


.native-ui-tweaks() {
  .tree-view-resizer {
    // border-bottom: 1px solid #C7C7C7;
  }
}
.native-ui-tweaks();


////////////////////////////////////////////////////////////////////////////////////////////////////
//
//    ######## #### ##       ########    ####  ######   #######  ##    ##  ######
//    ##        ##  ##       ##           ##  ##    ## ##     ## ###   ## ##    ##
//    ##        ##  ##       ##           ##  ##       ##     ## ####  ## ##
//    ######    ##  ##       ######       ##  ##       ##     ## ## ## ##  ######
//    ##        ##  ##       ##           ##  ##       ##     ## ##  ####       ##
//    ##        ##  ##       ##           ##  ##    ## ##     ## ##   ### ##    ##
//    ##       #### ######## ########    ####  ######   #######  ##    ##  ######
//
////////////////////////////////////////////////////////////////////////////////////////////////////

// Change the icon for JavaScript files from a thin, hard-to-see outline, to a beefy block icon
.custom-js-icon() {
  @import "../../../../../.atom/packages/file-icons/styles/icons";
  @import "../../../../../.atom/packages/file-icons/styles/items";

  .js-custom-icon { .mf; content: "\f129"; font-size: large; }

  @{pane-tab-override}, .icon-file-text {
    &[data-name$=".js"]:before,
    &[data-name$=".es6"]:before,
    &[data-name$=".es"]:before,
    &[data-name$=".js.erb"]:before  {
      .js-custom-icon;
    }
  }
}
.custom-js-icon();


////////////////////////////////////////////////////////////////////////////////////////////////////
//
//    ########    ###    ########     ########     ###    ########
//       ##      ## ##   ##     ##    ##     ##   ## ##   ##     ##
//       ##     ##   ##  ##     ##    ##     ##  ##   ##  ##     ##
//       ##    ##     ## ########     ########  ##     ## ########
//       ##    ######### ##     ##    ##     ## ######### ##   ##
//       ##    ##     ## ##     ##    ##     ## ##     ## ##    ##
//       ##    ##     ## ########     ########  ##     ## ##     ##
//
////////////////////////////////////////////////////////////////////////////////////////////////////

.tab-bar-tweaks() when (@ui-theme-name = one-light-ui) {
  // Put a dividing line at the right side of the last tab, to separate it from the empty tab bar
  .tab-bar li.tab:last-of-type,
  .tab-bar .tab.active + li.tab:last-of-type {
      border-width: 0 1px 0 1px;
      border-image: linear-gradient(#d1d4dc, #babfca 1em) 0 1 0 1 stretch;
  }
}
// .tab-bar-tweaks();


////////////////////////////////////////////////////////////////////////////////////////////////////
//
//    ######## ########  ######## ########    ##     ## #### ######## ##      ##
//       ##    ##     ## ##       ##          ##     ##  ##  ##       ##  ##  ##
//       ##    ##     ## ##       ##          ##     ##  ##  ##       ##  ##  ##
//       ##    ########  ######   ######      ##     ##  ##  ######   ##  ##  ##
//       ##    ##   ##   ##       ##           ##   ##   ##  ##       ##  ##  ##
//       ##    ##    ##  ##       ##            ## ##    ##  ##       ##  ##  ##
//       ##    ##     ## ######## ########       ###    #### ########  ###  ###
//
////////////////////////////////////////////////////////////////////////////////////////////////////

.tree-view-tweaks() {
  .tree-view {
    // background: lighten(@base-background-color, 0%);
    // border-right: 1px solid @pane-item-border-color;

    // Make the selected file's background darker than usual
    // .selected:before {
    //   background: darken(@base-background-color, 8%); //hsla(@ui-hue, @ui-saturation, 50%, .25);
    // }

    // Make the tree view list slightly more compact (default line-height is 24px/~2.2em)
    .list-item { line-height: 2em !important; }

    // Make the top-level folder (project roots) more distinct
    & > li.project-root  {
      // Make project root's font size larger
      & > .header {
        font-size: 1.1em;
      }

      // Put a border + margin/padding before project root (skipping the first one)
      &:nth-child(1n+2) {
        margin-top: 0.5em;
        border-top: 1px solid darken(@base-background-color, 10%);
        padding-top: 0.5em;
      }
    }
  }
}
.tree-view-tweaks();


////////////////////////////////////////////////////////////////////////////////////////////////////
//
//     ######  ########    ###    ######## ##     ##  ######     ########     ###    ########
//    ##    ##    ##      ## ##      ##    ##     ## ##    ##    ##     ##   ## ##   ##     ##
//    ##          ##     ##   ##     ##    ##     ## ##          ##     ##  ##   ##  ##     ##
//     ######     ##    ##     ##    ##    ##     ##  ######     ########  ##     ## ########
//          ##    ##    #########    ##    ##     ##       ##    ##     ## ######### ##   ##
//    ##    ##    ##    ##     ##    ##    ##     ## ##    ##    ##     ## ##     ## ##    ##
//     ######     ##    ##     ##    ##     #######   ######     ########  ##     ## ##     ##
//
////////////////////////////////////////////////////////////////////////////////////////////////////

.status-bar-tweaks() {
  status-bar  {
    @sb-border-color: contrast(@tool-panel-background-color, darken(@base-border-color, 10%), lighten(@base-border-color, 10%));
    @sb-border-image: linear-gradient(@tool-panel-background-color, @sb-border-color 20%, @sb-border-color 80%, @tool-panel-background-color);

    // Add border between sidebar and status bar
    // border-left: 1px solid @sb-border-color;

    .status-bar-left {
      // Add border on the right of every block in the left status bar
      & > .inline-block,
      & > linter-bottom-container > .inline-block {
        margin-right: 1em;
        padding-right: 1em;

        border-width: 0 1px 0 0;
        border-image: @sb-border-image 0 1 0 0 stretch;
      }

      // Make the linter status be the last item on the left side, by floating everything else left  a
      & > div { float: left; }
    }

    .status-bar-right {
      // Add border on the left of every block in the right status bar
      & > .inline-block {
        padding-left: 1em;
        margin-left: 1em;

        border-width: 0 0 0 1px;
        border-image: @sb-border-image 0 0 0 1 stretch;
      }
    }

    // Fix bug where the middle button was rounded instead of the first+last
    linter-bottom-tab { border-radius: 0 0 0 0 !important; }
    linter-bottom-tab:first-of-type { border-radius: 4px 0 0 4px !important; }
    linter-bottom-tab:nth-of-type(1n+2) { border-radius: 0 4px 4px 0 !important; }
    // There's still a bug if the last tab (project tab) is hidden; the "file" tab then becomes the
    // last visible tab, but it has a square border because it's still only the second tab element.
  }

  // Give cursor position bar a min-width big enough for 3 digit lines & column, to cut down on the
  // status bar components moving around as the cursor position changes.
  .cursor-position {
    min-width: 12.5em;
    text-align: center;
  }
}
.status-bar-tweaks();


////////////////////////////////////////////////////////////////////////////////////////////////////
//
//    ##     ## #### ##    ## #### ##     ##    ###    ########
//    ###   ###  ##  ###   ##  ##  ###   ###   ## ##   ##     ##
//    #### ####  ##  ####  ##  ##  #### ####  ##   ##  ##     ##
//    ## ### ##  ##  ## ## ##  ##  ## ### ## ##     ## ########
//    ##     ##  ##  ##  ####  ##  ##     ## ######### ##
//    ##     ##  ##  ##   ###  ##  ##     ## ##     ## ##
//    ##     ## #### ##    ## #### ##     ## ##     ## ##
//
////////////////////////////////////////////////////////////////////////////////////////////////////

.minimap-tweaks() {
  // For minimap, use slightly lighter/darker (whichever contrasts more) variant of editor bg
  @minimap-bgcolor: contrast(@syntax-background-color,
    darken(@syntax-background-color, 2%),
    lighten(@syntax-background-color, 2%));
  // Color of border on left-side of minimap (to separate it from the editor)
  @border-color: contrast(@syntax-background-color,
    darken(@syntax-wrap-guide-color, 10%),
    lighten(@syntax-wrap-guide-color, 10%));
  // Color used for background of "visible area" block & its borders
  @visible-area-color: rgba(146, 146, 146, 1.0);

  // Only apply the styles to editors with a minimap
  @{plain-text-editor}[with-minimap]::shadow {
    // Hide the editor's native scrollbar, so that we can use the minimap exclusively to scroll
    .vertical-scrollbar { opacity: 0; width: 0; }

    atom-text-editor-minimap {
      // Set background to 1px border + chosen background color (specified via a linear gradient
      // background image so that it doesn't affect element size, as `border: 1px ...` would).
      background-image: linear-gradient(to right,
        @border-color, @border-color 1px,
        @minimap-bgcolor 1px, @minimap-bgcolor);
      // background-color: @minimap-bgcolor;

      // Give the "visible area" block top+bottom borders, and a more transparent bg
      &::shadow .minimap-visible-area::after {
        background-color: fadeout(@visible-area-color, 70%);
        border-top: 1px solid @visible-area-color;
        border-bottom: 1px solid @visible-area-color;
      }
    }

    // Tweak colors of minimap decorations
    // .minimap {
    //   // More subtle git diff highlights
    //   .line {
    //     .git-line-modified { background: fadeOut(@syntax-color-modified, 40%); }
    //     .git-line-added    { background: fadeOut(@syntax-color-added, 30%); }
    //     .git-line-removed  { background: fadeOut(@syntax-color-removed, 60%); }
    //   }
    //
    //   // More distinct current lint highlight
    //   .cursor-line {
    //     background: mix(@minimap-bgcolor, @syntax-cursor-color, 40%);
    //   }
    // }
  }
}
.minimap-tweaks();


////////////////////////////////////////////////////////////////////////////////////////////////////
//
//       ###    ##     ## ########  #######   ######   #######  ##     ## ########  ##       ######## ######## ########
//      ## ##   ##     ##    ##    ##     ## ##    ## ##     ## ###   ### ##     ## ##       ##          ##    ##
//     ##   ##  ##     ##    ##    ##     ## ##       ##     ## #### #### ##     ## ##       ##          ##    ##
//    ##     ## ##     ##    ##    ##     ## ##       ##     ## ## ### ## ########  ##       ######      ##    ######
//    ######### ##     ##    ##    ##     ## ##       ##     ## ##     ## ##        ##       ##          ##    ##
//    ##     ## ##     ##    ##    ##     ## ##    ## ##     ## ##     ## ##        ##       ##          ##    ##
//    ##     ##  #######     ##     #######   ######   #######  ##     ## ##        ######## ########    ##    ########
//
////////////////////////////////////////////////////////////////////////////////////////////////////

autocomplete-suggestion-list {
  &.select-list.popover-list {
    .suggestion-description {
      padding-top: 7px;
      padding-bottom: 7px;
      border-top: 1px solid @base-border-color;
    }

    .suggestion-description-content {
      font-size: @font-size;
      color: fade(@text-color-subtle, 100%);
    }

    &.suggestion-list-scroller { }
  }

  .icon.snippet { color: darken(@syntax-color-snippet, 20%); }
}


////////////////////////////////////////////////////////////////////////////////////////////////////
//
//       ###    ##    ## ######## ####    ###    ##       ####    ###     ######
//      ## ##   ###   ##    ##     ##    ## ##   ##        ##    ## ##   ##    ##
//     ##   ##  ####  ##    ##     ##   ##   ##  ##        ##   ##   ##  ##
//    ##     ## ## ## ##    ##     ##  ##     ## ##        ##  ##     ##  ######
//    ######### ##  ####    ##     ##  ######### ##        ##  #########       ##
//    ##     ## ##   ###    ##     ##  ##     ## ##        ##  ##     ## ##    ##
//    ##     ## ##    ##    ##    #### ##     ## ######## #### ##     ##  ######
//
////////////////////////////////////////////////////////////////////////////////////////////////////

.antialiasing() {
  // On non-Retina displays, use subpixel antialiasing (makes text easy to read, but a bit "fat")
  atom-text-editor, .tab-bar .tab .title {
    -webkit-font-smoothing: subpixel-antialiased;
    // -webkit-font-smoothing: antialiased;
  }

  // On Retina displays, use regular (non-subpixel) antialiasing (looks sharper, though thinner)
  @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
      atom-text-editor, .tab-bar .tab .title { -webkit-font-smoothing: antialiased; }
  }
}
// .antialiasing();


////////////////////////////////////////////////////////////////////////////////////////////////////
//
//    ##          ###    ##    ##  ######   ##     ##    ###     ######   ########  ######
//    ##         ## ##   ###   ## ##    ##  ##     ##   ## ##   ##    ##  ##       ##    ##
//    ##        ##   ##  ####  ## ##        ##     ##  ##   ##  ##        ##       ##
//    ##       ##     ## ## ## ## ##   #### ##     ## ##     ## ##   #### ######    ######
//    ##       ######### ##  #### ##    ##  ##     ## ######### ##    ##  ##             ##
//    ##       ##     ## ##   ### ##    ##  ##     ## ##     ## ##    ##  ##       ##    ##
//    ######## ##     ## ##    ##  ######    #######  ##     ##  ######   ########  ######
//
////////////////////////////////////////////////////////////////////////////////////////////////////

.language-markdown-tweaks() {
  atom-text-editor .text.md {
    .list {
      & { color: @syntax-text-color; }
      & > .punctuation { color: #b57b91; }
    }

    .destination.link, .underline.link {
      color: hsl(286, 60%, 67%);
    }

    .heading {
      font-weight: bold;

      @heading-color: hsl(207, 82%, 66%);
      & > .heading-1 { color: mix(@heading-color, @syntax-text-color, 100%); }
      & > .heading-2 { color: mix(@heading-color, @syntax-text-color, 85%); }
      & > .heading-3 { color: mix(@heading-color, @syntax-text-color, 70%); }
      & > .heading-4 { color: mix(@heading-color, @syntax-text-color, 55%); }
      & > .heading-5 { color: mix(@heading-color, @syntax-text-color, 40%); }
      & > .heading-6 { color: mix(@heading-color, @syntax-text-color, 35%); }
    }
  }
}
.language-markdown-tweaks();


.language-git-commit-tweaks() {
  // Disable angry, red highlighting of Git commit message lines that are "too long". This is the
  // future, we have soft wrapping. I can type as much as I want, and my computer always shows lines
  // at a nice width. If your PDP-11 can't do that, I shouldn't be responsible for doing it for you.
  // (And even if I wanted to, Atom doesn't support automatically hard wrapping text, and there's no
  // way I'm manually doing that.) If I'm forced to, I'll just use a Git commit message filter.

  // Don't turn off the angry, red text on the first line, since that's used as the commit summary,
  // and should still be kept short so that you can skim logs, with one line per commit.
  atom-text-editor .line:not([data-screen-row="0"]) .text.git-commit {
    .invalid.illegal.line-too-long {
      // This removes colors set by grammar scopes. Text will then use the editor's default colors.
      background-color: inherit;
      color: inherit;
    }
  }
}
.language-git-commit-tweaks();


// vim:set fileencoding=utf8 fileformat=unix filetype=less tabstop=4 expandtab:
