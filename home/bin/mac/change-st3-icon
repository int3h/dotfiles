#!/usr/bin/env bash

if [ $# -gt 2 ] || [[ "$1" == "-h" ]] || [[ "$1" == "--help" ]]; then
    echo "Usage: `basename $0` [<source icon> [<target icon>]]"
    echo "Replace Sublime Text 3's icon with a better one"
    echo "Default to \"/Users/mtorok/Pictures/Creations/ST2_Icons/Sublime Text.icn\" for the source and \"/Applications/Sublime Text.app/Contents/Resources/Sublime Text.icns\" for the target."
    exit 1
fi

NEWICON=${1-"/Users/mtorok/Pictures/Creations/ST2_Icons/Sublime Text.icns"}
OLDICON=${2-"/Applications/Sublime Text.app/Contents/Resources/Sublime Text.icns"}


echo -e "Replacing Sublime Text icon at \"$OLDICON\" with icon at \"$NEWICON\"...\n"

if [[ `md5 -q "$NEWICON"` == `md5 -q "$OLDICON"` ]]; then
    echo "Sublime Text's icon is already changed to the new icon. Exiting."
    exit
fi

SAVEDICON="`dirname "$OLDICON"`/Sublime Text.$RANDOM.old.icns"
cp "$OLDICON" "$SAVEDICON"
cp "$NEWICON" "$OLDICON"

echo "Done. Old icon saved as \"$SAVEDICON\" "
