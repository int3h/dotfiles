#!/usr/bin/env bash

NEWICON_DEFAULT="$HOME/Pictures/Icons/Sublime/Sublime Text.icns"
NEWICON=${1-$NEWICON_DEFAULT}
OLDICON_DEFAULT='/Applications/Sublime Text.app/Contents/Resources/Sublime Text.icns'
OLDICON=${2-$OLDICON_DEFAULT}

if [ $# -gt 2 ] || [[ "$1" == "-h" ]] || [[ "$1" == "--help" ]]; then
    echo "Usage: `basename $0` [<source icon> [<target icon>]]"
    echo "Replace Sublime Text 3's icon with a better one"
    echo "Default to \"$NEWICON_DEFAULT\" for the source and \"$OLDICON_DEFAULT\" for the target."
    exit 1
fi

if [[ ! -f "$NEWICON" ]] || [[ ! -f "$OLDICON" ]]; then
    echo "Could not find new icon '$NEWICON' and/or old icon '$OLDICON'. Exiting..." >&2
    exit 1
fi

echo -e "Replacing Sublime Text icon at \"$OLDICON\" with icon at \"$NEWICON\"...\n"

if [[ `md5 -q "$NEWICON"` == `md5 -q "$OLDICON"` ]]; then
    echo "Sublime Text's icon is already changed to the new icon. Exiting."
    exit
fi

SAVEDICON="`dirname "$OLDICON"`/Sublime Text.$RANDOM.old.icns"
cp "$OLDICON" "$SAVEDICON"
cp "$NEWICON" "$OLDICON"

echo "Done. Old icon saved as \"$SAVEDICON\" "
