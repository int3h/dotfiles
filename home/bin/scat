#!/usr/bin/env bash

# `scat`: view a file with syntax highlighting.
#
# Requires Pygments and jq (optional) to work.
#   OS X:  pip install -I --force-reinstall pygments && pip install mistune && brew install jq
#   Linux: sudo apt-get install python-pygments jq


# TODO: Support piped intput in addition to file path arguments
source_file="$@"

if [[ "$source_file" == *.json ]] && type -t jq >/dev/null; then
    # jq can colorize and pretty print JSON, so use it for files ending in .json
    colorize_command="jq -C ."
elif type -t pygmentize >/dev/null; then
    # Colorize with pygments, using native color scheme, 256 colors, and guess input syntax
    colorize_command='pygmentize -P style=native -f terminal256 -g'
else
    colorize_command='cat'
fi


# Use `cat` for files that fit within one terminal window, `less` for longer ones
if [[ $(wc -l "$source_file" | awk '{print $1}') -gt $(tput lines) ]]; then
    # Enable ASCII color parsing, enable line numbers, disable line soft wrap
    viewer="less -RNS"
else
    # Enable line numbers in output
    viewer="cat -n"
fi


command $colorize_command "$source_file" | $viewer
